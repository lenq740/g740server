changelog - G740Server

-----------------------------------
Версия от 2020-01-31
-----------------------------------
lib-g740server.php - исправлена ошибка в экспорте главного меню системы

-----------------------------------
Версия от 2020-01-28
-----------------------------------
lib-base.php str2JavaScript - обработка символа \r

-----------------------------------
Версия от 2020-01-27
-----------------------------------
DataSource::onLog - логирование изменений
	добавлено свойство DataSource::isLog - необходимость логирования
	объявлен обработчик события onLog, сделаны обращения к нему из запросов save, delete, copy
	в запросе DataSource::execDelete список возвращаемых строк теперь начитываем не SQL запросом, а вызовом execRefreshForce
		в результате присутствуют связанные значения из справочников
		
DataSource::getIsDeleteExecuted - проверка, выполняется ли в момент обращения к методу операция удаления

-----------------------------------
Версия от 2020-01-20
-----------------------------------
DataSource - изменения в системе прав
	DataSource::getPerm проверяет наличие запроса в списке поддерживаемых источником данных запросов DataSource::getRequests()
	вызов DataSource::getPerm без $params (не задан $params['#request.name']) проверяет допустимость запроса в принцепе,
		без контекста использования. Такое обращение, например, происходит при формировании XML описания источника данных
		и списка поддерживаемых им запросов
	соответственно, при формировании XML описания списка запросов источника данных, теперь используется не глобальная функция getPerm()
		а метод DataSource::getPerm() без указания контекста использования $params
	в описании списка запросов DataSource::getRequests() появился новый параметр запроса 'enabled', если его задат в false
		то проверка прав этот запрос пропускать не будет

-----------------------------------
Версия от 2019-12-02
-----------------------------------
ext-controller.php добавлены CSS для формирования WORD

-----------------------------------
Версия от 2019-12-01
-----------------------------------
lib-base.php добавлена функция проверки файла на наличие и незанятость другим процессом testFileFree

-----------------------------------
Версия от 2019-11-25
-----------------------------------
Отчеты lib-report.php, параметр tgroup.itog теперь может содержать текст подитога

-----------------------------------
Версия от 2019-11-23
-----------------------------------
Обработка запроса copy
	вариант вызова execCopyForce - для подчиненных таблиц, игнорируя контроль прав (с клиента этот метод вызвать нельзя)
	поле tmpid стало необязательным, если его нет, то просто нельзя узнать, откуда скопированна эта строка
	исправлен синтаксис SQL запроса в execCopy для PostgreSQL

Обработка запроса refresh
	вариант вызова execRefreshForce - для служебных нужд, игнорируя контроль прав (с клиента этот метод вызвать нельзя)
	
В lib-g740server.php дополнительный контроль безопасности для входных параметров запроса
	имя входного параметра проверяется на # в начале имени, дабы нельзя было с клиента задать значения служебных параметров

В DataSource в комментариях переименованы операции в запросы

-----------------------------------
Версия от 2019-11-18
-----------------------------------
Преобразование php2SqlIn корректно обрабатывает строку id, с разделителем в виде запятой

-----------------------------------
Версия от 2019-11-15
-----------------------------------
Поддержка запуска утилит в CLI режиме

-----------------------------------
Версия от 2019-11-11
-----------------------------------
include-utils
	Запуск с правами root - проверка IP адреса, добавлен вариант $_SERVER['REMOTE_ADDR']==$_SERVER['SERVER_ADDR']

-----------------------------------
Версия от 2019-11-01
-----------------------------------
execCopy - исправление незначительных ошибок

-----------------------------------
Версия от 2019-10-30
-----------------------------------
execCopy - новая технология копирования

-----------------------------------
Версия от 2019-10-28
-----------------------------------
Добавлена экранная форма formSysIcons - список доступных иконок

-----------------------------------
Версия от 2019-10-23
-----------------------------------
Обнаружилось, что драйвер MS-SQL требует вызова closeCursor, без closeCursor не срабатывает lastinsertid
	Возникали ошибки в execCopy, исправления в getOrdAppend

-----------------------------------
Версия от 2019-10-09
-----------------------------------
Новый способ диагностирование Internet Explorer
	Проверка перенесена из include-index.php в визуализатор G740

-----------------------------------
Версия от 2019-10-03
-----------------------------------
Новая технология подключения иконок
	- старая технология подключения иконок через предворительно подготовленный CSS осталась, 
		но поменялось название настройки, теперь это $config['project.icons.css']
	- новая технология $config['project.icons.file'] не требует предваритеьного CSS, описывает связь иконки и файла из папки $config['path.root.resource.icons']
		'иконка'=>'имя файла' или 'иконка'=>Array('имя файла', 'имя файла white', width, height)

-----------------------------------
Версия от 2019-09-30
-----------------------------------
Обработчики событий
	- новое событие onRowAfter - вызывается после refresh и append, а это покрывает собой все, кроме delete
	
Проверка полей перед сохранением
	- doBeforeSave проверяет поля num на переполнение, если в описании есть len, dec

-----------------------------------
Версия от 2019-09-24
-----------------------------------
Запрос execCopy
	добавлено mode= first|last|after|before
	параметр <имя поля>=значение - подменить значение поля значением из параметра
	параметр <имя поля>.rename=1 - добавить к значению поля слово <копия>

-----------------------------------
Версия от 2019-09-24
-----------------------------------
Обработчики событий на удаление
	- в качестве row обработчикам передаются содержимые строк удаляемой таблицы (связанные таблицы не подцепливаются)

Правка структуры данных
	- корректная обработка ord при добавлении строк
	
Уничтожен механизм vrsession - слишком сложен

Новый механизм трассировки запросов вместо FireBug подключен в include-index.php
	- параметр вызова log=1 включает трассировку, log=0 отключает трассировку

-----------------------------------
Версия от 2019-09-21
-----------------------------------
Правка главного меню системы
	- корректная обработка ord при добавлении и переносе строк

Экспорт в виде SQL скрипта для MSSQL сервера
	- добавлено set dateformat ymd;

-----------------------------------
Версия от 2019-09-18
-----------------------------------
Обработчики событий
	- новое событие onAfterDelete - групповое, передается список строк, вызывается один раз

-----------------------------------
Версия от 2019-09-14
-----------------------------------
utils
	- новый механизм запуска утилиты от имени root - атрибут $isCanExecutedAsRoot, параметр root=1, обработка перенесена в include-utils.php
	- название утилиты перенесено в атрибут $caption
	- исправлена загрузка структуры базы из XML описания для PostGreSQL

-----------------------------------
Версия от 2019-09-11
-----------------------------------
Обработка ошибок запроса save
	Убран поясняющий текст из сообщения об ошибке, так как функционал перенесен на клиента.

-----------------------------------
Версия от 2019-08-31
-----------------------------------
Генерация HTML страниц - полностью перестроена, с потерей совместимости
	- изменен класс PageViewer - из него убран разбор входных параметров, теперь это отдельный класс PageUrlController

-----------------------------------
Версия от 2019-08-29
-----------------------------------
Обработчики событий
	Добавлены новые
		- onBeforeRefresh, onBeforeAppend, onBeforeSave, onBeforeInsert, onBeforeUpdate, onBeforeDelete
		- onRowAfterRefresh, onRowAfterAppend, onRowAfterSave, onRowAfterInsert, onRowAfterUpdate, onRowAfterDelete
		- onRowValid
	Объявлены устаревшими, но поддерживаются для совместимости
		- onValid
		- onAfterSave
		- onAfterInsert
		- onRowReadOnly
	Уничтожены
		- onGetPerm
		
Защита от CSRF уязвимости, включается настройкой csrftoken.enabled
	- В config-g740server-default настройка csrftoken.enabled=true
	- Новый параметр getPP('csrftoken') для хранения значения token
	- Метод execConnect теперь должен инициализировать 'csrftoken', иначе будет диагностирована ошибка
	- Поддержка csrftoken протоколом G740: 
		- include-index.php инициализирует у клиента g740.config.csrfToken
		- include-g740.php передает csrftoken при connect и проверяет в других запросах
	- Поддержка csrftoken механизмом utils
		- formUtils передает csrftoken
		- асинхронный вызов execUtility() передает csrftoken
		- include-utils.php проверяет csrftoken
Запуск утилиты rebuild с правами root по HTTP теперь разрешен только с localhost

-----------------------------------
Версия от 2019-08-28
-----------------------------------
Проверка getOwnerReadOnly() в execAppend() - если поле связи с родительским источником данных не заполнено, операция execAppend() разрешена

Обработка ошибок запроса save
	К сообщению об ошибке при выполнении запроса save добавлен текст: Исправьте и сохраните повторно, или отмените изменения кнопкой 'Отменить (Esc)'

